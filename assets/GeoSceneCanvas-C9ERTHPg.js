import{r as d,p as R,J as O}from"./index-DSSi2gOi.js";import{e as P,c as L,a as k,t as A,p as z,b as B,r as N,l as q,d as I,h as G,f as K,g as Q,i as C,o as U,j as V}from"./transform-CXiXsZ1_.js";function j(n,t,c){n=+n,t=+t,c=(r=arguments.length)<2?(t=n,n=0,1):r<3?1:+c;for(var u=-1,r=Math.max(0,Math.ceil((t-n)/c))|0,s=new Array(r);++u<r;)s[u]=n+u*c;return s}function F(n,t,c){var u=j(n,t-P,c).concat(t);return function(r){return u.map(function(s){return[r,s]})}}function X(n,t,c){var u=j(n,t-P,c).concat(t);return function(r){return u.map(function(s){return[s,r]})}}function W(){var n,t,c,u,r,s,o,g,x=10,E=x,p=90,f=360,M,l,i,m,v=2.5;function a(){return{type:"MultiLineString",coordinates:h()}}function h(){return j(L(u/p)*p,c,p).map(i).concat(j(L(g/f)*f,o,f).map(m)).concat(j(L(t/x)*x,n,x).filter(function(e){return k(e%p)>P}).map(M)).concat(j(L(s/E)*E,r,E).filter(function(e){return k(e%f)>P}).map(l))}return a.lines=function(){return h().map(function(e){return{type:"LineString",coordinates:e}})},a.outline=function(){return{type:"Polygon",coordinates:[i(u).concat(m(o).slice(1),i(c).reverse().slice(1),m(g).reverse().slice(1))]}},a.extent=function(e){return arguments.length?a.extentMajor(e).extentMinor(e):a.extentMinor()},a.extentMajor=function(e){return arguments.length?(u=+e[0][0],c=+e[1][0],g=+e[0][1],o=+e[1][1],u>c&&(e=u,u=c,c=e),g>o&&(e=g,g=o,o=e),a.precision(v)):[[u,g],[c,o]]},a.extentMinor=function(e){return arguments.length?(t=+e[0][0],n=+e[1][0],s=+e[0][1],r=+e[1][1],t>n&&(e=t,t=n,n=e),s>r&&(e=s,s=r,r=e),a.precision(v)):[[t,s],[n,r]]},a.step=function(e){return arguments.length?a.stepMajor(e).stepMinor(e):a.stepMinor()},a.stepMajor=function(e){return arguments.length?(p=+e[0],f=+e[1],a):[p,f]},a.stepMinor=function(e){return arguments.length?(x=+e[0],E=+e[1],a):[x,E]},a.precision=function(e){return arguments.length?(v=+e,M=F(s,r,90),l=X(t,n,v),i=F(g,o,90),m=X(u,c,v),a):v},a.extentMajor([[-180,-90+P],[180,90-P]]).extentMinor([[-180,-80-P],[180,80+P]])}function Z(){return W()()}function D(n,t){return[n,q(I((G+t)/2))]}D.invert=function(n,t){return[n,2*K(Q(t))-G]};function $(){return H(D).scale(961/A)}function H(n){var t=z(n),c=t.center,u=t.scale,r=t.translate,s=t.clipExtent,o=null,g,x,E;t.scale=function(f){return arguments.length?(u(f),p()):u()},t.translate=function(f){return arguments.length?(r(f),p()):r()},t.center=function(f){return arguments.length?(c(f),p()):c()},t.clipExtent=function(f){return arguments.length?(f==null?o=g=x=E=null:(o=+f[0][0],g=+f[0][1],x=+f[1][0],E=+f[1][1]),p()):o==null?null:[[o,g],[x,E]]};function p(){var f=B*u(),M=t(N(t.rotate()).invert([0,0]));return s(o==null?[[M[0]-f,M[1]-f],[M[0]+f,M[1]+f]]:n===D?[[Math.max(M[0]-f,o),g],[Math.min(M[0]+f,x),E]]:[[o,Math.max(M[1]-f,g)],[x,Math.min(M[1]+f,E)]])}return p()}function T(n,t){const c=d.useRef(),u=d.useRef(n),r=d.useRef(null),s=d.useRef(t);d.useEffect(()=>{u.current=n,s.current=t},[n,t]);const o=d.useCallback((...g)=>{if(c.current){r.current=g;return}u.current(...g),c.current=setTimeout(()=>{r.current&&(u.current(...r.current),r.current=null),c.current=void 0},s.current)},[]);return o.cancel=()=>c.current?(clearTimeout(c.current),c.current=void 0,r.current=null,!0):!1,d.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),o}function Y(n,t,c){return Math.max(t,Math.min(c,n))}function b(n,t,c,u){return n==="Mercator"?$().scale(150).rotate(t).translate([c/2,u/2]):U().scale(Math.min(c/2,u/2)).rotate(t).translate([c/2,u/2])}const _=({projectionType:n,data:t,featureSelectCallback:c})=>{const u=d.useRef(null),r=d.useRef(null),s=d.useRef({isPressed:!1,isMoved:!1,lastPosition:{x:0,y:0}}),o=d.useRef([-24.9,-60.2,0]),g=d.useRef(""),x=l=>{let i=n==="Orthographic"?90:0;return[l[0],Y(l[1],-i,i),Y(l[2],0,0)]},E=(l,i)=>{if(!r.current||!t)return;const m=r.current;if(!m.getContext("2d"))return;let a=b(n,o.current,m.width,m.height);const h=a.invert?a.invert([l,i]):[0,0];if(!h)return null;const e=a(h);if(!e||Math.sqrt((e[0]-l)*(e[0]-l)+(e[1]-i)*(e[1]-i))>1)return null;for(const y of t.features)if(V(y,h))return y;return null},p=()=>{if(!r.current)return;const i=r.current.getContext("2d");i&&(i.clearRect(0,0,i.canvas.width,i.canvas.height),M(),f())},f=()=>{if(!t||!r.current)return;const l=r.current,i=l.getContext("2d");if(!i)return;let m=b(n,o.current,l.width,l.height),v=C().projection(m).context(i);t.features.forEach(a=>{i.fillStyle=g.current===a.properties.name?"orange":"#369",i.strokeStyle="white",i.beginPath(),v(a),i.fill(),i.stroke()})},M=()=>{if(!r.current)return;const l=r.current,i=l.getContext("2d");if(!i)return;let m=b(n,o.current,l.width,l.height),v=C().projection(m).context(i),a=Z();i.beginPath(),v(a),i.strokeStyle="gray",i.lineWidth=1,i.stroke()};return d.useEffect(()=>{if(!u.current)return;const l=new ResizeObserver(()=>{if(!u.current||!r.current)return;const{clientWidth:i,clientHeight:m}=u.current;r.current.width=i,r.current.height=m,p()});return l.observe(u.current),()=>{u.current&&l.unobserve(u.current)}},[t,n]),d.useEffect(()=>{o.current=x(o.current)},[n]),d.useEffect(()=>{if(!u.current||!r.current)return;const l=r.current,i=h=>{const e=r.current;if(!e)return{x:0,y:0};const w=e.getBoundingClientRect();return"touches"in h?h.touches.length>0?{x:h.touches[0].clientX-w.left,y:h.touches[0].clientY-w.top}:{x:s.current.lastPosition.x,y:s.current.lastPosition.y}:{x:h.clientX-w.left,y:h.clientY-w.top}},m=h=>{h.preventDefault(),console.log("handleStartDrag"),s.current.isPressed=!0;const{x:e,y:w}=i(h);s.current.lastPosition={x:e,y:w}},v=h=>{if(h.preventDefault(),!s.current.isPressed)return;s.current.isMoved=!0;const{x:e,y:w}=i(h),y=e-s.current.lastPosition.x,J=w-s.current.lastPosition.y;if(s.current.lastPosition={x:e,y:w},"touches"in h&&h.touches.length>0||h instanceof MouseEvent&&h.button===0){const S=o.current;o.current=x([S[0]+y/2,S[1]-J/2,S[2]]),p()}},a=h=>{if(h.preventDefault(),console.log("handleEndDrag"),!s.current.isMoved&&(!(h instanceof MouseEvent)||h.button===0)){const{x:e,y:w}=i(h);console.log("Left-click detected at",e,w);const y=E(e,w);g.current=y?y.properties.name:null,c(y),p()}s.current.isPressed=!1,s.current.isMoved=!1};return p(),l.addEventListener("mousedown",m),window.addEventListener("mousemove",v),l.addEventListener("mouseup",a),l.addEventListener("touchstart",m),window.addEventListener("touchmove",v),l.addEventListener("touchend",a),()=>{l.removeEventListener("mousedown",m),window.removeEventListener("mousemove",v),l.removeEventListener("mouseup",a),l.removeEventListener("touchstart",m),window.removeEventListener("touchmove",v),l.removeEventListener("touchend",a)}},[t,n]),R.jsx("div",{ref:u,style:{width:"100%",height:"100%"},children:R.jsx("canvas",{ref:r})})},ne=({projectionType:n,setCountryInfo:t})=>{const[c,u]=d.useState(null),r=async()=>{console.log("loadData()");try{const o=await fetch("/dev-site-misc/geo/custom_110.geo.json");if(!o.ok)throw new Error("Failed to fetch JSON file");const g=await o.json();u(g)}catch(o){console.error("Error loading JSON:",o)}},s=T(o=>{if(!o){t(null);return}let g={name:o.properties.name,name_en:o.properties.name_en,continent:o.properties.continent,pop_est:o.properties.pop_est,pop_year:o.properties.pop_year,type:o.properties.type,postal:o.properties.postal,iso_a2_eh:o.properties.iso_a2_eh};t(g)},100);return d.useEffect(()=>{console.log("useEffect"),r()},[]),R.jsx(R.Fragment,{children:R.jsx(O,{width:"100%",height:"100%",sx:{position:"relative"},children:R.jsx(_,{projectionType:n,data:c,featureSelectCallback:s})})})};export{ne as GeoScene};
