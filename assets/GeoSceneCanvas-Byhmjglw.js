import{r as l,j as a,B as d,a as R}from"./index-B0CixmEj.js";import{i as J,j as N,o as z}from"./transform-CXiXsZ1_.js";function B(i,t){return z().scale(2e3).rotate([-12,-63,-10]).translate([i/2,t/2])}const D=({data:i})=>{const t=l.useRef(null),r=l.useRef(null),[o,f]=l.useState(null),S=()=>{if(!o)return;const s=new Blob([o],{type:"text/plain"}),e=URL.createObjectURL(s),c=document.createElement("a");c.href=e,c.download="scandinavia.json",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(e)},O=()=>{o&&navigator.clipboard.writeText(o)},b=()=>{if(!r.current)return;const e=r.current.getContext("2d");e&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),E())},E=()=>{if(!i||!r.current)return;const s=r.current,e=s.getContext("2d");if(!e)return;let c=B(s.width,s.height),k=J().projection(c).context(e);const h=new Map;i.features.forEach(n=>{e.fillStyle="#369",["FIN","SWE","NOR","DNK"].includes(n.properties.adm0_a3)&&(h.set(n.properties.adm0_a3,n),e.strokeStyle="white",e.beginPath(),k(n),e.fill(),e.stroke())});const g={},x={};for(const[n,u]of h)g[n]=[],x[n]=u.geometry.coordinates;let j=!1;const p=40,v=1;for(let n=0;n<s.height;n+=p*Math.sqrt(3)/2){for(let u=j?p/2:0;u<s.width;u+=p){const w=c.invert([u,n]);e.fillStyle="white";for(const[y,C]of h){const m=N(C,w);m&&g[y].push(w),m&&y==="FIN"&&(e.fillStyle="orange")}e.beginPath(),e.ellipse(u,n,v,v,0,0,360),e.fill()}j=!j}f(JSON.stringify({pointsObj:g,boundaryObj:x}))};return l.useEffect(()=>{if(!t.current)return;const s=new ResizeObserver(()=>{if(!t.current||!r.current)return;const{clientWidth:e,clientHeight:c}=t.current;r.current.width=e,r.current.height=c,b()});return s.observe(t.current),()=>{t.current&&s.unobserve(t.current)}},[i]),l.useEffect(()=>{!t.current||!r.current||b()},[i]),a.jsxs(d,{children:[a.jsxs(d,{sx:{display:"flex",gap:2,my:2},children:[a.jsx(R,{variant:"contained",size:"large",disabled:!o,onClick:()=>S(),children:"Download json"}),a.jsx(R,{variant:"contained",size:"large",disabled:!o,onClick:()=>O(),children:"Clipboard json"})]}),a.jsx(d,{ref:t,style:{width:"100%",height:"70vh"},children:a.jsx("canvas",{ref:r})})]})},U=()=>{const[i,t]=l.useState(null),r=async()=>{console.log("loadData()");try{const o=await fetch("/dev-site-misc/geo/custom_50.geo.json");if(!o.ok)throw new Error("Failed to fetch JSON file");const f=await o.json();t(f)}catch(o){console.error("Error loading JSON:",o)}};return l.useEffect(()=>{console.log("useEffect"),r()},[]),a.jsx(d,{children:a.jsx(D,{data:i})})};export{U as GeoScene};
