import{r as M,p as j,J as k,K as O,U as z}from"./index-DdsksEN6.js";import{e as P,c as R,a as X,t as A,p as B,b as N,r as q,l as K,d as U,h as G,f as I,g as Q,i as Y,o as V,j as W}from"./transform-CXiXsZ1_.js";function L(r,t,f){r=+r,t=+t,f=(o=arguments.length)<2?(t=r,r=0,1):o<3?1:+f;for(var i=-1,o=Math.max(0,Math.ceil((t-r)/f))|0,u=new Array(o);++i<o;)u[i]=r+i*f;return u}function C(r,t,f){var i=L(r,t-P,f).concat(t);return function(o){return i.map(function(u){return[o,u]})}}function F(r,t,f){var i=L(r,t-P,f).concat(t);return function(o){return i.map(function(u){return[u,o]})}}function Z(){var r,t,f,i,o,u,n,g,v=10,x=v,m=90,l=360,E,a,c,p,d=2.5;function s(){return{type:"MultiLineString",coordinates:h()}}function h(){return L(R(i/m)*m,f,m).map(c).concat(L(R(g/l)*l,n,l).map(p)).concat(L(R(t/v)*v,r,v).filter(function(e){return X(e%m)>P}).map(E)).concat(L(R(u/x)*x,o,x).filter(function(e){return X(e%l)>P}).map(a))}return s.lines=function(){return h().map(function(e){return{type:"LineString",coordinates:e}})},s.outline=function(){return{type:"Polygon",coordinates:[c(i).concat(p(n).slice(1),c(f).reverse().slice(1),p(g).reverse().slice(1))]}},s.extent=function(e){return arguments.length?s.extentMajor(e).extentMinor(e):s.extentMinor()},s.extentMajor=function(e){return arguments.length?(i=+e[0][0],f=+e[1][0],g=+e[0][1],n=+e[1][1],i>f&&(e=i,i=f,f=e),g>n&&(e=g,g=n,n=e),s.precision(d)):[[i,g],[f,n]]},s.extentMinor=function(e){return arguments.length?(t=+e[0][0],r=+e[1][0],u=+e[0][1],o=+e[1][1],t>r&&(e=t,t=r,r=e),u>o&&(e=u,u=o,o=e),s.precision(d)):[[t,u],[r,o]]},s.step=function(e){return arguments.length?s.stepMajor(e).stepMinor(e):s.stepMinor()},s.stepMajor=function(e){return arguments.length?(m=+e[0],l=+e[1],s):[m,l]},s.stepMinor=function(e){return arguments.length?(v=+e[0],x=+e[1],s):[v,x]},s.precision=function(e){return arguments.length?(d=+e,E=C(u,o,90),a=F(t,r,d),c=C(g,n,90),p=F(i,f,d),s):d},s.extentMajor([[-180,-90+P],[180,90-P]]).extentMinor([[-180,-80-P],[180,80+P]])}function $(){return Z()()}function D(r,t){return[r,K(U((G+t)/2))]}D.invert=function(r,t){return[r,2*I(Q(t))-G]};function H(){return T(D).scale(961/A)}function T(r){var t=B(r),f=t.center,i=t.scale,o=t.translate,u=t.clipExtent,n=null,g,v,x;t.scale=function(l){return arguments.length?(i(l),m()):i()},t.translate=function(l){return arguments.length?(o(l),m()):o()},t.center=function(l){return arguments.length?(f(l),m()):f()},t.clipExtent=function(l){return arguments.length?(l==null?n=g=v=x=null:(n=+l[0][0],g=+l[0][1],v=+l[1][0],x=+l[1][1]),m()):n==null?null:[[n,g],[v,x]]};function m(){var l=N*i(),E=t(q(t.rotate()).invert([0,0]));return u(n==null?[[E[0]-l,E[1]-l],[E[0]+l,E[1]+l]]:r===D?[[Math.max(E[0]-l,n),g],[Math.min(E[0]+l,v),x]]:[[n,Math.max(E[1]-l,g)],[v,Math.min(E[1]+l,x)]])}return m()}function b(r,t,f,i){return r==="Mercator"?H().scale(150).rotate(t).translate([f/2,i/2]):V().scale(Math.min(f/2,i/2)).rotate(t).translate([f/2,i/2])}const _=({projectionType:r,data:t,featureSelectCallback:f})=>{const i=M.useRef(null),o=M.useRef(null),u=M.useRef({isPressed:!1,isMoved:!1,lastPosition:{x:0,y:0}}),n=M.useRef([-24.9,-60.2,0]),g=M.useRef(""),v=a=>{let c=r==="Orthographic"?90:0;return[a[0],k(a[1],-c,c),k(a[2],0,0)]},x=(a,c)=>{if(!o.current||!t)return;const p=o.current;if(!p.getContext("2d"))return;let s=b(r,n.current,p.width,p.height);const h=s.invert?s.invert([a,c]):[0,0];if(!h)return null;const e=s(h);if(!e||Math.sqrt((e[0]-a)*(e[0]-a)+(e[1]-c)*(e[1]-c))>1)return null;for(const y of t.features)if(W(y,h))return y;return null},m=()=>{if(!o.current)return;const c=o.current.getContext("2d");c&&(c.clearRect(0,0,c.canvas.width,c.canvas.height),E(),l())},l=()=>{if(!t||!o.current)return;const a=o.current,c=a.getContext("2d");if(!c)return;let p=b(r,n.current,a.width,a.height),d=Y().projection(p).context(c);t.features.forEach(s=>{c.fillStyle=g.current===s.properties.name?"orange":"#369",c.strokeStyle="white",c.beginPath(),d(s),c.fill(),c.stroke()})},E=()=>{if(!o.current)return;const a=o.current,c=a.getContext("2d");if(!c)return;let p=b(r,n.current,a.width,a.height),d=Y().projection(p).context(c),s=$();c.beginPath(),d(s),c.strokeStyle="gray",c.lineWidth=1,c.stroke()};return M.useEffect(()=>{if(!i.current)return;const a=new ResizeObserver(()=>{if(!i.current||!o.current)return;const{clientWidth:c,clientHeight:p}=i.current;o.current.width=c,o.current.height=p,m()});return a.observe(i.current),()=>{i.current&&a.unobserve(i.current)}},[t,r]),M.useEffect(()=>{n.current=v(n.current)},[r]),M.useEffect(()=>{if(!i.current||!o.current)return;const a=o.current,c=h=>{const e=o.current;if(!e)return{x:0,y:0};const w=e.getBoundingClientRect();return"touches"in h?h.touches.length>0?{x:h.touches[0].clientX-w.left,y:h.touches[0].clientY-w.top}:{x:u.current.lastPosition.x,y:u.current.lastPosition.y}:{x:h.clientX-w.left,y:h.clientY-w.top}},p=h=>{h.preventDefault(),console.log("handleStartDrag"),u.current.isPressed=!0;const{x:e,y:w}=c(h);u.current.lastPosition={x:e,y:w}},d=h=>{if(h.preventDefault(),!u.current.isPressed)return;u.current.isMoved=!0;const{x:e,y:w}=c(h),y=e-u.current.lastPosition.x,J=w-u.current.lastPosition.y;if(u.current.lastPosition={x:e,y:w},"touches"in h&&h.touches.length>0||h instanceof MouseEvent&&h.button===0){const S=n.current;n.current=v([S[0]+y/2,S[1]-J/2,S[2]]),m()}},s=h=>{if(h.preventDefault(),console.log("handleEndDrag"),!u.current.isMoved&&(!(h instanceof MouseEvent)||h.button===0)){const{x:e,y:w}=c(h);console.log("Left-click detected at",e,w);const y=x(e,w);g.current=y?y.properties.name:null,f(y),m()}u.current.isPressed=!1,u.current.isMoved=!1};return m(),a.addEventListener("mousedown",p),window.addEventListener("mousemove",d),a.addEventListener("mouseup",s),a.addEventListener("touchstart",p),window.addEventListener("touchmove",d),a.addEventListener("touchend",s),()=>{a.removeEventListener("mousedown",p),window.removeEventListener("mousemove",d),a.removeEventListener("mouseup",s),a.removeEventListener("touchstart",p),window.removeEventListener("touchmove",d),a.removeEventListener("touchend",s)}},[t,r]),j.jsx("div",{ref:i,style:{width:"100%",height:"100%"},children:j.jsx("canvas",{ref:o})})},ne=({projectionType:r,setCountryInfo:t})=>{const[f,i]=M.useState(null),o=async()=>{console.log("loadData()");try{const n=await fetch("/dev-site-misc/geo/custom_110.geo.json");if(!n.ok)throw new Error("Failed to fetch JSON file");const g=await n.json();i(g)}catch(n){console.error("Error loading JSON:",n)}},u=O(n=>{if(!n){t(null);return}let g={name:n.properties.name,name_en:n.properties.name_en,continent:n.properties.continent,pop_est:n.properties.pop_est,pop_year:n.properties.pop_year,type:n.properties.type,postal:n.properties.postal,iso_a2_eh:n.properties.iso_a2_eh};t(g)},100);return M.useEffect(()=>{console.log("useEffect"),o()},[]),j.jsx(j.Fragment,{children:j.jsx(z,{width:"100%",height:"100%",sx:{position:"relative"},children:j.jsx(_,{projectionType:r,data:f,featureSelectCallback:u})})})};export{ne as GeoScene};
