import{r as M,p as j,J as O}from"./index-Jw2Xkb4H.js";import{e as P,c as L,a as k,t as z,p as A,b as B,r as N,l as q,d as I,h as G,f as K,g as Q,i as C,o as U,j as V}from"./transform-CXiXsZ1_.js";function R(n,t,c){n=+n,t=+t,c=(o=arguments.length)<2?(t=n,n=0,1):o<3?1:+c;for(var u=-1,o=Math.max(0,Math.ceil((t-n)/c))|0,s=new Array(o);++u<o;)s[u]=n+u*c;return s}function F(n,t,c){var u=R(n,t-P,c).concat(t);return function(o){return u.map(function(s){return[o,s]})}}function X(n,t,c){var u=R(n,t-P,c).concat(t);return function(o){return u.map(function(s){return[s,o]})}}function W(){var n,t,c,u,o,s,r,g,v=10,x=v,p=90,f=360,E,l,i,m,d=2.5;function a(){return{type:"MultiLineString",coordinates:h()}}function h(){return R(L(u/p)*p,c,p).map(i).concat(R(L(g/f)*f,r,f).map(m)).concat(R(L(t/v)*v,n,v).filter(function(e){return k(e%p)>P}).map(E)).concat(R(L(s/x)*x,o,x).filter(function(e){return k(e%f)>P}).map(l))}return a.lines=function(){return h().map(function(e){return{type:"LineString",coordinates:e}})},a.outline=function(){return{type:"Polygon",coordinates:[i(u).concat(m(r).slice(1),i(c).reverse().slice(1),m(g).reverse().slice(1))]}},a.extent=function(e){return arguments.length?a.extentMajor(e).extentMinor(e):a.extentMinor()},a.extentMajor=function(e){return arguments.length?(u=+e[0][0],c=+e[1][0],g=+e[0][1],r=+e[1][1],u>c&&(e=u,u=c,c=e),g>r&&(e=g,g=r,r=e),a.precision(d)):[[u,g],[c,r]]},a.extentMinor=function(e){return arguments.length?(t=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],t>n&&(e=t,t=n,n=e),s>o&&(e=s,s=o,o=e),a.precision(d)):[[t,s],[n,o]]},a.step=function(e){return arguments.length?a.stepMajor(e).stepMinor(e):a.stepMinor()},a.stepMajor=function(e){return arguments.length?(p=+e[0],f=+e[1],a):[p,f]},a.stepMinor=function(e){return arguments.length?(v=+e[0],x=+e[1],a):[v,x]},a.precision=function(e){return arguments.length?(d=+e,E=F(s,o,90),l=X(t,n,d),i=F(g,r,90),m=X(u,c,d),a):d},a.extentMajor([[-180,-90+P],[180,90-P]]).extentMinor([[-180,-80-P],[180,80+P]])}function Z(){return W()()}function D(n,t){return[n,q(I((G+t)/2))]}D.invert=function(n,t){return[n,2*K(Q(t))-G]};function $(){return H(D).scale(961/z)}function H(n){var t=A(n),c=t.center,u=t.scale,o=t.translate,s=t.clipExtent,r=null,g,v,x;t.scale=function(f){return arguments.length?(u(f),p()):u()},t.translate=function(f){return arguments.length?(o(f),p()):o()},t.center=function(f){return arguments.length?(c(f),p()):c()},t.clipExtent=function(f){return arguments.length?(f==null?r=g=v=x=null:(r=+f[0][0],g=+f[0][1],v=+f[1][0],x=+f[1][1]),p()):r==null?null:[[r,g],[v,x]]};function p(){var f=B*u(),E=t(N(t.rotate()).invert([0,0]));return s(r==null?[[E[0]-f,E[1]-f],[E[0]+f,E[1]+f]]:n===D?[[Math.max(E[0]-f,r),g],[Math.min(E[0]+f,v),x]]:[[r,Math.max(E[1]-f,g)],[v,Math.min(E[1]+f,x)]])}return p()}function Y(n,t,c){return Math.max(t,Math.min(c,n))}function T(n,t){const c=M.useRef(),u=M.useRef(0),o=(...s)=>{const r=performance.now();if(clearTimeout(c.current),r>u.current+t){u.current=r,n(...s);return}c.current=setTimeout(()=>{n(...s),c.current=void 0},t)};return o.cancel=()=>c.current?(clearTimeout(c.current),c.current=void 0,!0):!1,M.useEffect(()=>()=>{clearTimeout(c.current),c.current=void 0},[]),o}function b(n,t,c,u){return n==="Mercator"?$().scale(150).rotate(t).translate([c/2,u/2]):U().scale(Math.min(c/2,u/2)).rotate(t).translate([c/2,u/2])}const _=({projectionType:n,data:t,featureSelectCallback:c})=>{const u=M.useRef(null),o=M.useRef(null),s=M.useRef({isPressed:!1,isMoved:!1,lastPosition:{x:0,y:0}}),r=M.useRef([-24.9,-60.2,0]),g=M.useRef(""),v=l=>{let i=n==="Orthographic"?90:0;return[l[0],Y(l[1],-i,i),Y(l[2],0,0)]},x=(l,i)=>{if(!o.current||!t)return;const m=o.current;if(!m.getContext("2d"))return;let a=b(n,r.current,m.width,m.height);const h=a.invert?a.invert([l,i]):[0,0];if(!h)return null;const e=a(h);if(!e||Math.sqrt((e[0]-l)*(e[0]-l)+(e[1]-i)*(e[1]-i))>1)return null;for(const y of t.features)if(V(y,h))return y;return null},p=()=>{if(!o.current)return;const i=o.current.getContext("2d");i&&(i.clearRect(0,0,i.canvas.width,i.canvas.height),E(),f())},f=()=>{if(!t||!o.current)return;const l=o.current,i=l.getContext("2d");if(!i)return;let m=b(n,r.current,l.width,l.height),d=C().projection(m).context(i);t.features.forEach(a=>{i.fillStyle=g.current===a.properties.name?"orange":"#369",i.strokeStyle="white",i.beginPath(),d(a),i.fill(),i.stroke()})},E=()=>{if(!o.current)return;const l=o.current,i=l.getContext("2d");if(!i)return;let m=b(n,r.current,l.width,l.height),d=C().projection(m).context(i),a=Z();i.beginPath(),d(a),i.strokeStyle="gray",i.lineWidth=1,i.stroke()};return M.useEffect(()=>{if(!u.current)return;const l=new ResizeObserver(()=>{if(!u.current||!o.current)return;const{clientWidth:i,clientHeight:m}=u.current;o.current.width=i,o.current.height=m,p()});return l.observe(u.current),()=>{u.current&&l.unobserve(u.current)}},[t,n]),M.useEffect(()=>{r.current=v(r.current)},[n]),M.useEffect(()=>{if(!u.current||!o.current)return;const l=o.current,i=h=>{const e=o.current;if(!e)return{x:0,y:0};const w=e.getBoundingClientRect();return"touches"in h?h.touches.length>0?{x:h.touches[0].clientX-w.left,y:h.touches[0].clientY-w.top}:{x:s.current.lastPosition.x,y:s.current.lastPosition.y}:{x:h.clientX-w.left,y:h.clientY-w.top}},m=h=>{h.preventDefault(),console.log("handleStartDrag"),s.current.isPressed=!0;const{x:e,y:w}=i(h);s.current.lastPosition={x:e,y:w}},d=h=>{if(h.preventDefault(),!s.current.isPressed)return;s.current.isMoved=!0;const{x:e,y:w}=i(h),y=e-s.current.lastPosition.x,J=w-s.current.lastPosition.y;if(s.current.lastPosition={x:e,y:w},"touches"in h&&h.touches.length>0||h instanceof MouseEvent&&h.button===0){const S=r.current;r.current=v([S[0]+y/2,S[1]-J/2,S[2]]),p()}},a=h=>{if(h.preventDefault(),console.log("handleEndDrag"),!s.current.isMoved&&(!(h instanceof MouseEvent)||h.button===0)){const{x:e,y:w}=i(h);console.log("Left-click detected at",e,w);const y=x(e,w);g.current=y?y.properties.name:null,c(y),p()}s.current.isPressed=!1,s.current.isMoved=!1};return p(),l.addEventListener("mousedown",m),window.addEventListener("mousemove",d),l.addEventListener("mouseup",a),l.addEventListener("touchstart",m),window.addEventListener("touchmove",d),l.addEventListener("touchend",a),()=>{l.removeEventListener("mousedown",m),window.removeEventListener("mousemove",d),l.removeEventListener("mouseup",a),l.removeEventListener("touchstart",m),window.removeEventListener("touchmove",d),l.removeEventListener("touchend",a)}},[t,n]),j.jsx("div",{ref:u,style:{width:"100%",height:"100%"},children:j.jsx("canvas",{ref:o})})},ne=({projectionType:n,setCountryInfo:t})=>{const[c,u]=M.useState(null),o=async()=>{console.log("loadData()");try{const r=await fetch("/dev-site-misc/geo/custom_110.geo.json");if(!r.ok)throw new Error("Failed to fetch JSON file");const g=await r.json();u(g)}catch(r){console.error("Error loading JSON:",r)}},s=T(r=>{if(!r){t(null);return}let g={name:r.properties.name,name_en:r.properties.name_en,continent:r.properties.continent,pop_est:r.properties.pop_est,pop_year:r.properties.pop_year,type:r.properties.type,postal:r.properties.postal,iso_a2_eh:r.properties.iso_a2_eh};t(g)},100);return M.useEffect(()=>{console.log("useEffect"),o()},[]),j.jsx(j.Fragment,{children:j.jsx(O,{width:"100%",height:"100%",sx:{position:"relative"},children:j.jsx(_,{projectionType:n,data:c,featureSelectCallback:s})})})};export{ne as GeoScene};
