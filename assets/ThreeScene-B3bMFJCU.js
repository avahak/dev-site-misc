var se=Object.defineProperty;var ie=(f,e,t)=>e in f?se(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var y=(f,e,t)=>ie(f,typeof e!="symbol"?e+"":e,t);import{r as D,j as ne}from"./index-D8TtdHeW.js";import{V as z,C as S,L as J,F as Y,G as re,B as G,a as C,b as O,M as q,P as F,c as Z,d as T,e as P,f as N,g as oe,h as ae,R as le,i as B,D as ce,T as he,S as ue,j as $,k as pe,Q as I,l as de,m as fe,W as me,n as ge,A as ve,o as be}from"./three.module-BxuQ6Me3.js";import{O as we}from"./OrbitControls-B2pJcEgC.js";const ye=/^[og]\s*(.+)?/,xe=/^mtllib /,je=/^usemtl /,Le=/^usemap /,H=/\s+/,W=new z,_=new z,K=new z,Q=new z,j=new z,V=new S;function Me(){const f={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,i){const l=this._finalize(!1);l&&(l.inherited||l.groupCount<=0)&&this.materials.splice(l.index,1);const r={index:this.materials.length,name:s||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:l!==void 0?l.smooth:this.smooth,groupStart:l!==void 0?l.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){const o={index:typeof a=="number"?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return o.clone=this.clone.bind(o),o}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),s&&this.materials.length>1)for(let l=this.materials.length-1;l>=0;l--)this.materials[l].groupCount<=0&&this.materials.splice(l,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},n&&n.name&&typeof n.clone=="function"){const s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const s=this.vertices,i=this.object.geometry.vertices;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const s=this.normals,i=this.object.geometry.normals;i.push(s[e+0],s[e+1],s[e+2]),i.push(s[t+0],s[t+1],s[t+2]),i.push(s[n+0],s[n+1],s[n+2])},addFaceNormal:function(e,t,n){const s=this.vertices,i=this.object.geometry.normals;W.fromArray(s,e),_.fromArray(s,t),K.fromArray(s,n),j.subVectors(K,_),Q.subVectors(W,_),j.cross(Q),j.normalize(),i.push(j.x,j.y,j.z),i.push(j.x,j.y,j.z),i.push(j.x,j.y,j.z)},addColor:function(e,t,n){const s=this.colors,i=this.object.geometry.colors;s[e]!==void 0&&i.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&i.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&i.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){const s=this.uvs,i=this.object.geometry.uvs;i.push(s[e+0],s[e+1]),i.push(s[t+0],s[t+1]),i.push(s[n+0],s[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,i,l,r,a,o){const h=this.vertices.length;let c=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),p=this.parseVertexIndex(n,h);if(this.addVertex(c,u,p),this.addColor(c,u,p),r!==void 0&&r!==""){const w=this.normals.length;c=this.parseNormalIndex(r,w),u=this.parseNormalIndex(a,w),p=this.parseNormalIndex(o,w),this.addNormal(c,u,p)}else this.addFaceNormal(c,u,p);if(s!==void 0&&s!==""){const w=this.uvs.length;c=this.parseUVIndex(s,w),u=this.parseUVIndex(i,w),p=this.parseUVIndex(l,w),this.addUV(c,u,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,s=e.length;n<s;n++){const i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,s=this.uvs.length;for(let i=0,l=e.length;i<l;i++)this.addVertexLine(this.parseVertexIndex(e[i],n));for(let i=0,l=t.length;i<l;i++)this.addUVLine(this.parseUVIndex(t[i],s))}};return f.startObject("",!1),f}class ke extends J{constructor(e){super(e),this.materials=null}load(e,t,n,s){const i=this,l=new Y(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(r){try{t(i.parse(r))}catch(a){s?s(a):console.error(a),i.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Me;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let s=[];for(let r=0,a=n.length;r<a;r++){const o=n[r].trimStart();if(o.length===0)continue;const h=o.charAt(0);if(h!=="#")if(h==="v"){const c=o.split(H);switch(c[0]){case"v":t.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),c.length>=7?(V.setRGB(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6])).convertSRGBToLinear(),t.colors.push(V.r,V.g,V.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":t.uvs.push(parseFloat(c[1]),parseFloat(c[2]));break}}else if(h==="f"){const u=o.slice(1).trim().split(H),p=[];for(let m=0,d=u.length;m<d;m++){const g=u[m];if(g.length>0){const v=g.split("/");p.push(v)}}const w=p[0];for(let m=1,d=p.length-1;m<d;m++){const g=p[m],v=p[m+1];t.addFace(w[0],g[0],v[0],w[1],g[1],v[1],w[2],g[2],v[2])}}else if(h==="l"){const c=o.substring(1).trim().split(" ");let u=[];const p=[];if(o.indexOf("/")===-1)u=c;else for(let w=0,m=c.length;w<m;w++){const d=c[w].split("/");d[0]!==""&&u.push(d[0]),d[1]!==""&&p.push(d[1])}t.addLineGeometry(u,p)}else if(h==="p"){const u=o.slice(1).trim().split(" ");t.addPointGeometry(u)}else if((s=ye.exec(o))!==null){const c=(" "+s[0].slice(1).trim()).slice(1);t.startObject(c)}else if(je.test(o))t.object.startMaterial(o.substring(7).trim(),t.materialLibraries);else if(xe.test(o))t.materialLibraries.push(o.substring(7).trim());else if(Le.test(o))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(s=o.split(" "),s.length>1){const u=s[1].trim().toLowerCase();t.object.smooth=u!=="0"&&u!=="off"}else t.object.smooth=!0;const c=t.object.currentMaterial();c&&(c.smooth=t.object.smooth)}else{if(o==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+o+'"')}}t.finalize();const i=new re;if(i.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let r=0,a=t.objects.length;r<a;r++){const o=t.objects[r],h=o.geometry,c=o.materials,u=h.type==="Line",p=h.type==="Points";let w=!1;if(h.vertices.length===0)continue;const m=new G;m.setAttribute("position",new C(h.vertices,3)),h.normals.length>0&&m.setAttribute("normal",new C(h.normals,3)),h.colors.length>0&&(w=!0,m.setAttribute("color",new C(h.colors,3))),h.hasUVIndices===!0&&m.setAttribute("uv",new C(h.uvs,2));const d=[];for(let v=0,A=c.length;v<A;v++){const M=c[v],U=M.name+"_"+M.smooth+"_"+w;let b=t.materials[U];if(this.materials!==null){if(b=this.materials.create(M.name),u&&b&&!(b instanceof O)){const k=new O;q.prototype.copy.call(k,b),k.color.copy(b.color),b=k}else if(p&&b&&!(b instanceof F)){const k=new F({size:10,sizeAttenuation:!1});q.prototype.copy.call(k,b),k.color.copy(b.color),k.map=b.map,b=k}}b===void 0&&(u?b=new O:p?b=new F({size:1,sizeAttenuation:!1}):b=new Z,b.name=M.name,b.flatShading=!M.smooth,b.vertexColors=w,t.materials[U]=b),d.push(b)}let g;if(d.length>1){for(let v=0,A=c.length;v<A;v++){const M=c[v];m.addGroup(M.groupStart,M.groupCount,v)}u?g=new T(m,d):p?g=new P(m,d):g=new N(m,d)}else u?g=new T(m,d[0]):p?g=new P(m,d[0]):g=new N(m,d[0]);g.name=o.name,i.add(g)}else if(t.vertices.length>0){const r=new F({size:1,sizeAttenuation:!1}),a=new G;a.setAttribute("position",new C(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(a.setAttribute("color",new C(t.colors,3)),r.vertexColors=!0);const o=new P(a,r);i.add(o)}return i}}class ze extends J{constructor(e){super(e)}load(e,t,n,s){const i=this,l=this.path===""?oe.extractUrlBase(e):this.path,r=new Y(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(a){try{t(i.parse(a,l))}catch(o){s?s(o):console.error(o),i.manager.itemError(e)}},n,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let s={};const i=/\s+/,l={};for(let a=0;a<n.length;a++){let o=n[a];if(o=o.trim(),o.length===0||o.charAt(0)==="#")continue;const h=o.indexOf(" ");let c=h>=0?o.substring(0,h):o;c=c.toLowerCase();let u=h>=0?o.substring(h+1):"";if(u=u.trim(),c==="newmtl")s={name:u},l[u]=s;else if(c==="ka"||c==="kd"||c==="ks"||c==="ke"){const p=u.split(i,3);s[c]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[c]=u}const r=new Ae(this.resourcePath||t,this.materialOptions);return r.setCrossOrigin(this.crossOrigin),r.setManager(this.manager),r.setMaterials(l),r}}class Ae{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:ae,this.wrap=this.options.wrap!==void 0?this.options.wrap:le}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const s=e[n],i={};t[n]=i;for(const l in s){let r=!0,a=s[l];const o=l.toLowerCase();switch(o){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&a[0]===0&&a[1]===0&&a[2]===0&&(r=!1);break}r&&(i[o]=a)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],s={name:e,side:this.side};function i(r,a){return typeof a!="string"||a===""?"":/^https?:\/\//i.test(a)?a:r+a}function l(r,a){if(s[r])return;const o=t.getTextureParams(a,s),h=t.loadTexture(i(t.baseUrl,o.url));h.repeat.copy(o.scale),h.offset.copy(o.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,(r==="map"||r==="emissiveMap")&&(h.colorSpace=ue),s[r]=h}for(const r in n){const a=n[r];let o;if(a!=="")switch(r.toLowerCase()){case"kd":s.color=new S().fromArray(a).convertSRGBToLinear();break;case"ks":s.specular=new S().fromArray(a).convertSRGBToLinear();break;case"ke":s.emissive=new S().fromArray(a).convertSRGBToLinear();break;case"map_kd":l("map",a);break;case"map_ks":l("specularMap",a);break;case"map_ke":l("emissiveMap",a);break;case"norm":l("normalMap",a);break;case"map_bump":case"bump":l("bumpMap",a);break;case"map_d":l("alphaMap",a),s.transparent=!0;break;case"ns":s.shininess=parseFloat(a);break;case"d":o=parseFloat(a),o<1&&(s.opacity=o,s.transparent=!0);break;case"tr":o=parseFloat(a),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(s.opacity=1-o,s.transparent=!0);break}}return this.materials[e]=new Z(s),this.materials[e]}getTextureParams(e,t){const n={scale:new B(1,1),offset:new B(0,0)},s=e.split(/\s+/);let i;return i=s.indexOf("-bm"),i>=0&&(t.bumpScale=parseFloat(s[i+1]),s.splice(i,2)),i=s.indexOf("-s"),i>=0&&(n.scale.set(parseFloat(s[i+1]),parseFloat(s[i+2])),s.splice(i,4)),i=s.indexOf("-o"),i>=0&&(n.offset.set(parseFloat(s[i+1]),parseFloat(s[i+2])),s.splice(i,4)),n.url=s.join(" ").trim(),n}loadTexture(e,t,n,s,i){const l=this.manager!==void 0?this.manager:ce;let r=l.getHandler(e);r===null&&(r=new he(l)),r.setCrossOrigin&&r.setCrossOrigin(this.crossOrigin);const a=r.load(e,n,s,i);return t!==void 0&&(a.mapping=t),a}}const x=class x{constructor(e,t,n){y(this,"sn");y(this,"mat");y(this,"vc");y(this,"vb");y(this,"vb2");this.sn=t.length,this.mat=e,this.vb=t,this.vb2=n,this.vc=Array(this.sn).fill(0);for(let s=0;s<this.sn;s++)this.vc[s]=e[s].reduce((i,l)=>i+l,0)}isValid(){if(!this.mat||!this.vb||!this.vc||this.mat.length!==this.sn||this.mat[0].length!==this.sn||this.vb.length!==this.sn||this.vc.length!==this.sn||this.vb2&&this.vb2.length!==this.sn)return!1;const e=this.vb.reduce((t,n)=>t+n,0);if(Math.abs(e-1)>100*Number.EPSILON)return!1;if(this.vb2){const t=this.vb2.reduce((n,s)=>n+s,0);if(Math.abs(t-1)>100*Number.EPSILON)return!1}return!0}};y(x,"EULER",new x([[0]],[1])),y(x,"MIDPOINT",new x([[0,0],[.5,0]],[0,1])),y(x,"HEUN",new x([[0,0],[1,0]],[.5,.5],[1,0])),y(x,"RK4",new x([[0,0,0,0],[.5,0,0,0],[0,.5,0,0],[0,0,1,0]],[1/6,1/3,1/3,1/6])),y(x,"RKF45",new x([[0,0,0,0,0,0],[1/4,0,0,0,0,0],[3/32,9/32,0,0,0,0],[1932/2197,-7200/2197,7296/2197,0,0,0],[439/216,-8,3680/513,-845/4104,0,0],[-8/27,2,-3544/2565,1859/4104,-11/40,0]],[16/135,0,6656/12825,28561/56430,-9/50,2/55],[25/216,0,1408/2565,2197/4104,-1/5,0])),y(x,"RKDP",new x([[0,0,0,0,0,0,0],[1/5,0,0,0,0,0,0],[3/40,9/40,0,0,0,0,0],[44/45,-56/15,32/9,0,0,0,0],[19372/6561,-25360/2187,64448/6561,-212/729,0,0,0],[9017/3168,-355/33,46732/5247,49/176,-5103/18656,0,0],[35/384,0,500/1113,125/192,-2187/6784,11/84,0]],[35/384,0,500/1113,125/192,-2187/6784,11/84,0],[5179/57600,0,7571/16695,393/640,-92097/339200,187/2100,1/40]));let E=x;class Ce{constructor(e,t){y(this,"f");y(this,"bt");this.f=e,this.bt=t}step(e,t,n,s=!1){const i=n-t,l=Array(this.bt.sn).fill([]);for(let r=0;r<this.bt.sn;r++){let a=[...e];for(let o=0;o<r;o++)a=this.vectorSum(1,a,this.bt.mat[r][o],l[o]);l[r]=this.f(t+i*this.bt.vc[r],a).map(o=>o*i)}return l.reduce((r,a,o)=>this.vectorSum(1,r,s?this.bt.vb2[o]:this.bt.vb[o],a),[...e])}solve(e,t,n,s){const i=[e],l=(n-t)/s;for(let r=0;r<s;r++)i.push(this.step(i[r],t+r*l,t+(r+1)*l));return i}adaptiveSolve(e,t,n,s){if(!this.bt.vb2)throw new Error("Adaptive solve requires vb2.");let i=(n-t)/5,l=[...e],r=t,a=0;for(;r<n;){r+i>n&&(i=n-r);const o=this.step(l,r,r+i),h=this.step(l,r,r+i,!0),c=this.vectorDist(o,h);c>s&&i>(n-t)/1e5?i*=.5:(r+=i,l=o,c<s*.1&&(i*=2)),a++}return a>100&&console.log(a),l}vectorSum(e,t,n,s){return t.map((i,l)=>e*i+n*s[l])}vectorDist(e,t){return Math.sqrt(e.reduce((n,s,i)=>n+(s-t[i])**2,0))}}const L=new z(1,2.5,.8),R=[(L.y*L.y+L.z*L.z)/12,(L.x*L.x+L.z*L.z)/12,(L.x*L.x+L.y*L.y)/12],X=new $().set(R[0],0,0,0,0,R[1],0,0,0,0,R[2],0,0,0,0,1),ee=new pe(1,.001,-5e-4,0).multiplyScalar(10),te=ee.clone().applyMatrix4(X),Fe=.5*ee.dot(te),Ve=(f,e)=>{const t=new I(...e),n=new $().makeRotationFromQuaternion(t),s=n.clone().multiply(X).multiply(n.clone().transpose());let i=te.clone().applyMatrix4(s.clone().invert()),l=.5*i.dot(i.clone().applyMatrix4(s));return i.multiplyScalar(Math.sqrt(Fe/l)),new I(...i.clone().multiplyScalar(.5)).multiply(t).toArray()},Se=new Ce(Ve,E.RKF45),Ie=(f,e)=>new I(...Se.adaptiveSolve(f.toArray(),0,e,1e-9)).normalize(),Ee=()=>{const f=D.useRef(null);return D.useEffect(()=>{if(!f.current)return;const e=new de,t=new fe(60,1,.1,1e3),n=new we(t,f.current),s=new me({antialias:!0,alpha:!0});s.setClearColor(0,0);let i=null,l=null;const r=new I(1,0,0,1).normalize();f.current.appendChild(s.domElement);const a=new ge(16777215,200,0);a.position.set(0,50,0),e.add(new ve(14544639,.8)),e.add(a),t.position.set(2,3,5),t.lookAt(new z(0,0,0));const h=new be().load(["/dev-site-misc/dzhanibekov/posx.jpg","/dev-site-misc/dzhanibekov/negx.jpg","/dev-site-misc/dzhanibekov/negy.jpg","/dev-site-misc/dzhanibekov/posy.jpg","/dev-site-misc/dzhanibekov/posz.jpg","/dev-site-misc/dzhanibekov/negz.jpg"]);h.flipY=!0,e.background=h;const c=()=>{if(!(f!=null&&f.current))return;const{clientWidth:d,clientHeight:g}=f.current;s.setSize(d,g),t.aspect=d/g,t.updateProjectionMatrix()};c();const u=new ResizeObserver(()=>{c()});u.observe(f.current);let p=null;new ze().load("/dev-site-misc/dzhanibekov/dz.mtl",d=>{d.preload();const g=new ke;g.setMaterials(d),g.load("/dev-site-misc/dzhanibekov/dz.obj",v=>{v.position.set(0,0,0),e.add(v),p=v})});const m=()=>{i=requestAnimationFrame(m);const d=performance.now(),g=l?Math.max(Math.min((d-l)/1e3,.1),0):0;l=d,p&&p.rotation.setFromQuaternion(r);const v=1;for(let A=0;A<v;A++)r.copy(Ie(r,g/v));s.render(e,t)};return m(),()=>{var d;f.current&&u.unobserve(f.current),(d=f.current)==null||d.removeChild(s.domElement),n.dispose(),i&&cancelAnimationFrame(i)}},[]),ne.jsx("div",{ref:f,style:{width:"100%",height:"100%"}})};export{Ee as default};
