import{r as J,j as ln,B as se}from"./index-D8TtdHeW.js";class nn{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const r=this._partials;let e=0;for(let i=0;i<this._n&&i<32;i++){const o=r[i],u=t+o,l=Math.abs(t)<Math.abs(o)?t-(u-o):o-(u-t);l&&(r[e++]=l),t=u}return r[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let r=this._n,e,i,o,u=0;if(r>0){for(u=t[--r];r>0&&(e=u,i=t[--r],u=e+i,o=i-(u-e),!o););r>0&&(o<0&&t[r-1]<0||o>0&&t[r-1]>0)&&(i=o*2,e=u+i,i==e-u&&(u=e))}return u}}function*he(n){for(const t of n)yield*t}function Bt(n){return Array.from(he(n))}function fn(n,t,r){n=+n,t=+t,r=(i=arguments.length)<2?(t=n,n=0,1):i<3?1:+r;for(var e=-1,i=Math.max(0,Math.ceil((t-n)/r))|0,o=new Array(i);++e<i;)o[e]=n+e*r;return o}var L=1e-6,qt=1e-12,_=Math.PI,B=_/2,gt=_/4,Z=_*2,q=180/_,C=_/180,I=Math.abs,Jt=Math.atan,rn=Math.atan2,A=Math.cos,Rn=Math.ceil,pe=Math.exp,ge=Math.log,F=Math.sin,ve=Math.sign||function(n){return n>0?1:n<0?-1:0},b=Math.sqrt,de=Math.tan;function Se(n){return n>1?0:n<-1?_:Math.acos(n)}function on(n){return n>1?B:n<-1?-B:Math.asin(n)}function O(){}function Fn(n,t){n&&dt.hasOwnProperty(n.type)&&dt[n.type](n,t)}var vt={Feature:function(n,t){Fn(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,e=-1,i=r.length;++e<i;)Fn(r[e].geometry,t)}},dt={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)n=r[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){Hn(n.coordinates,t,0)},MultiLineString:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)Hn(r[e],t,0)},Polygon:function(n,t){St(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)St(r[e],t)},GeometryCollection:function(n,t){for(var r=n.geometries,e=-1,i=r.length;++e<i;)Fn(r[e],t)}};function Hn(n,t,r){var e=-1,i=n.length-r,o;for(t.lineStart();++e<i;)o=n[e],t.point(o[0],o[1],o[2]);t.lineEnd()}function St(n,t){var r=-1,e=n.length;for(t.polygonStart();++r<e;)Hn(n[r],t,1);t.polygonEnd()}function en(n,t){n&&vt.hasOwnProperty(n.type)?vt[n.type](n,t):Fn(n,t)}function Wn(n){return[rn(n[1],n[0]),on(n[2])]}function sn(n){var t=n[0],r=n[1],e=A(r);return[e*A(t),e*F(t),F(r)]}function xn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Cn(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function kn(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Ln(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Kn(n){var t=b(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Qn(n,t){function r(e,i){return e=n(e,i),t(e[0],e[1])}return n.invert&&t.invert&&(r.invert=function(e,i){return e=t.invert(e,i),e&&n.invert(e[0],e[1])}),r}function Un(n,t){return I(n)>_&&(n-=Math.round(n/Z)*Z),[n,t]}Un.invert=Un;function Zt(n,t,r){return(n%=Z)?t||r?Qn(yt(n),wt(t,r)):yt(n):t||r?wt(t,r):Un}function Et(n){return function(t,r){return t+=n,I(t)>_&&(t-=Math.round(t/Z)*Z),[t,r]}}function yt(n){var t=Et(n);return t.invert=Et(-n),t}function wt(n,t){var r=A(n),e=F(n),i=A(t),o=F(t);function u(l,d){var v=A(d),c=A(l)*v,f=F(l)*v,h=F(d),s=h*r+c*e;return[rn(f*i-s*o,c*r-h*e),on(s*i+f*o)]}return u.invert=function(l,d){var v=A(d),c=A(l)*v,f=F(l)*v,h=F(d),s=h*i-f*o;return[rn(f*i+h*o,c*r+s*e),on(s*r-c*e)]},u}function Ee(n){n=Zt(n[0]*C,n[1]*C,n.length>2?n[2]*C:0);function t(r){return r=n(r[0]*C,r[1]*C),r[0]*=q,r[1]*=q,r}return t.invert=function(r){return r=n.invert(r[0]*C,r[1]*C),r[0]*=q,r[1]*=q,r},t}function ye(n,t,r,e,i,o){if(r){var u=A(t),l=F(t),d=e*r;i==null?(i=t+e*Z,o=t-d/2):(i=mt(u,i),o=mt(u,o),(e>0?i<o:i>o)&&(i+=e*Z));for(var v,c=i;e>0?c>o:c<o;c-=d)v=Wn([u,-l*A(c),-l*F(c)]),n.point(v[0],v[1])}}function mt(n,t){t=sn(t),t[0]-=n,Kn(t);var r=Se(-t[1]);return((-t[2]<0?-r:r)+Z-L)%Z}function Ht(){var n=[],t;return{point:function(r,e,i){t.push([r,e,i])},lineStart:function(){n.push(t=[])},lineEnd:O,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var r=n;return n=[],t=null,r}}}function Nn(n,t){return I(n[0]-t[0])<L&&I(n[1]-t[1])<L}function _n(n,t,r,e){this.x=n,this.z=t,this.o=r,this.e=e,this.v=!1,this.n=this.p=null}function Wt(n,t,r,e,i){var o=[],u=[],l,d;if(n.forEach(function(a){if(!((m=a.length-1)<=0)){var m,E=a[0],y=a[m],S;if(Nn(E,y)){if(!E[2]&&!y[2]){for(i.lineStart(),l=0;l<m;++l)i.point((E=a[l])[0],E[1]);i.lineEnd();return}y[0]+=2*L}o.push(S=new _n(E,a,null,!0)),u.push(S.o=new _n(E,null,S,!1)),o.push(S=new _n(y,a,null,!1)),u.push(S.o=new _n(y,null,S,!0))}}),!!o.length){for(u.sort(t),Mt(o),Mt(u),l=0,d=u.length;l<d;++l)u[l].e=r=!r;for(var v=o[0],c,f;;){for(var h=v,s=!0;h.v;)if((h=h.n)===v)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(s)for(l=0,d=c.length;l<d;++l)i.point((f=c[l])[0],f[1]);else e(h.x,h.n.x,1,i);h=h.n}else{if(s)for(c=h.p.z,l=c.length-1;l>=0;--l)i.point((f=c[l])[0],f[1]);else e(h.x,h.p.x,-1,i);h=h.p}h=h.o,c=h.z,s=!s}while(!h.v);i.lineEnd()}}}function Mt(n){if(t=n.length){for(var t,r=0,e=n[0],i;++r<t;)e.n=i=n[r],i.p=e,e=i;e.n=i=n[0],i.p=e}}function Bn(n){return I(n[0])<=_?n[0]:ve(n[0])*((I(n[0])+_)%Z-_)}function Kt(n,t){var r=Bn(t),e=t[1],i=F(e),o=[F(r),-A(r),0],u=0,l=0,d=new nn;i===1?e=B+L:i===-1&&(e=-B-L);for(var v=0,c=n.length;v<c;++v)if(h=(f=n[v]).length)for(var f,h,s=f[h-1],a=Bn(s),m=s[1]/2+gt,E=F(m),y=A(m),S=0;S<h;++S,a=w,E=R,y=$,s=p){var p=f[S],w=Bn(p),M=p[1]/2+gt,R=F(M),$=A(M),N=w-a,D=N>=0?1:-1,X=D*N,P=X>_,T=E*R;if(d.add(rn(T*D*F(X),y*$+T*A(X))),u+=P?N+D*Z:N,P^a>=r^w>=r){var Y=Cn(sn(s),sn(p));Kn(Y);var z=Cn(o,Y);Kn(z);var g=(P^N>=0?-1:1)*on(z[2]);(e>g||e===g&&(Y[0]||Y[1]))&&(l+=P^N>=0?1:-1)}}return(u<-L||u<L&&d<-qt)^l&1}function Qt(n,t,r,e){return function(i){var o=t(i),u=Ht(),l=t(u),d=!1,v,c,f,h={point:s,lineStart:m,lineEnd:E,polygonStart:function(){h.point=y,h.lineStart=S,h.lineEnd=p,c=[],v=[]},polygonEnd:function(){h.point=s,h.lineStart=m,h.lineEnd=E,c=Bt(c);var w=Kt(v,e);c.length?(d||(i.polygonStart(),d=!0),Wt(c,me,w,r,i)):w&&(d||(i.polygonStart(),d=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),d&&(i.polygonEnd(),d=!1),c=v=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function s(w,M){n(w,M)&&i.point(w,M)}function a(w,M){o.point(w,M)}function m(){h.point=a,o.lineStart()}function E(){h.point=s,o.lineEnd()}function y(w,M){f.push([w,M]),l.point(w,M)}function S(){l.lineStart(),f=[]}function p(){y(f[0][0],f[0][1]),l.lineEnd();var w=l.clean(),M=u.result(),R,$=M.length,N,D,X;if(f.pop(),v.push(f),f=null,!!$){if(w&1){if(D=M[0],(N=D.length-1)>0){for(d||(i.polygonStart(),d=!0),i.lineStart(),R=0;R<N;++R)i.point((X=D[R])[0],X[1]);i.lineEnd()}return}$>1&&w&2&&M.push(M.pop().concat(M.shift())),c.push(M.filter(we))}}return h}}function we(n){return n.length>1}function me(n,t){return((n=n.x)[0]<0?n[1]-B-L:B-n[1])-((t=t.x)[0]<0?t[1]-B-L:B-t[1])}const Pt=Qt(function(){return!0},Me,Re,[-_,-B]);function Me(n){var t=NaN,r=NaN,e=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(o,u){var l=o>0?_:-_,d=I(o-t);I(d-_)<L?(n.point(t,r=(r+u)/2>0?B:-B),n.point(e,r),n.lineEnd(),n.lineStart(),n.point(l,r),n.point(o,r),i=0):e!==l&&d>=_&&(I(t-e)<L&&(t-=e*L),I(o-l)<L&&(o-=l*L),r=Pe(t,r,o,u),n.point(e,r),n.lineEnd(),n.lineStart(),n.point(l,r),i=0),n.point(t=o,r=u),e=l},lineEnd:function(){n.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function Pe(n,t,r,e){var i,o,u=F(n-r);return I(u)>L?Jt((F(t)*(o=A(e))*F(r)-F(e)*(i=A(t))*F(n))/(i*o*u)):(t+e)/2}function Re(n,t,r,e){var i;if(n==null)i=r*B,e.point(-_,i),e.point(0,i),e.point(_,i),e.point(_,0),e.point(_,-i),e.point(0,-i),e.point(-_,-i),e.point(-_,0),e.point(-_,i);else if(I(n[0]-t[0])>L){var o=n[0]<t[0]?_:-_;i=r*o/2,e.point(-o,i),e.point(0,i),e.point(o,i)}else e.point(t[0],t[1])}function xe(n){var t=A(n),r=2*C,e=t>0,i=I(t)>L;function o(c,f,h,s){ye(s,n,r,h,c,f)}function u(c,f){return A(c)*A(f)>t}function l(c){var f,h,s,a,m;return{lineStart:function(){a=s=!1,m=1},point:function(E,y){var S=[E,y],p,w=u(E,y),M=e?w?0:v(E,y):w?v(E+(E<0?_:-_),y):0;if(!f&&(a=s=w)&&c.lineStart(),w!==s&&(p=d(f,S),(!p||Nn(f,p)||Nn(S,p))&&(S[2]=1)),w!==s)m=0,w?(c.lineStart(),p=d(S,f),c.point(p[0],p[1])):(p=d(f,S),c.point(p[0],p[1],2),c.lineEnd()),f=p;else if(i&&f&&e^w){var R;!(M&h)&&(R=d(S,f,!0))&&(m=0,e?(c.lineStart(),c.point(R[0][0],R[0][1]),c.point(R[1][0],R[1][1]),c.lineEnd()):(c.point(R[1][0],R[1][1]),c.lineEnd(),c.lineStart(),c.point(R[0][0],R[0][1],3)))}w&&(!f||!Nn(f,S))&&c.point(S[0],S[1]),f=S,s=w,h=M},lineEnd:function(){s&&c.lineEnd(),f=null},clean:function(){return m|(a&&s)<<1}}}function d(c,f,h){var s=sn(c),a=sn(f),m=[1,0,0],E=Cn(s,a),y=xn(E,E),S=E[0],p=y-S*S;if(!p)return!h&&c;var w=t*y/p,M=-t*S/p,R=Cn(m,E),$=Ln(m,w),N=Ln(E,M);kn($,N);var D=R,X=xn($,D),P=xn(D,D),T=X*X-P*(xn($,$)-1);if(!(T<0)){var Y=b(T),z=Ln(D,(-X-Y)/P);if(kn(z,$),z=Wn(z),!h)return z;var g=c[0],x=f[0],G=c[1],k=f[1],H;x<g&&(H=g,g=x,x=H);var gn=x-g,U=I(gn-_)<L,tn=U||gn<L;if(!U&&k<G&&(H=G,G=k,k=H),tn?U?G+k>0^z[1]<(I(z[0]-g)<L?G:k):G<=z[1]&&z[1]<=k:gn>_^(g<=z[0]&&z[0]<=x)){var V=Ln(D,(-X+Y)/P);return kn(V,$),[z,Wn(V)]}}}function v(c,f){var h=e?n:_-n,s=0;return c<-h?s|=1:c>h&&(s|=2),f<-h?s|=4:f>h&&(s|=8),s}return Qt(u,l,o,e?[0,-n]:[-_,n-_])}function Le(n,t,r,e,i,o){var u=n[0],l=n[1],d=t[0],v=t[1],c=0,f=1,h=d-u,s=v-l,a;if(a=r-u,!(!h&&a>0)){if(a/=h,h<0){if(a<c)return;a<f&&(f=a)}else if(h>0){if(a>f)return;a>c&&(c=a)}if(a=i-u,!(!h&&a<0)){if(a/=h,h<0){if(a>f)return;a>c&&(c=a)}else if(h>0){if(a<c)return;a<f&&(f=a)}if(a=e-l,!(!s&&a>0)){if(a/=s,s<0){if(a<c)return;a<f&&(f=a)}else if(s>0){if(a>f)return;a>c&&(c=a)}if(a=o-l,!(!s&&a<0)){if(a/=s,s<0){if(a>f)return;a>c&&(c=a)}else if(s>0){if(a<c)return;a<f&&(f=a)}return c>0&&(n[0]=u+c*h,n[1]=l+c*s),f<1&&(t[0]=u+f*h,t[1]=l+f*s),!0}}}}}var vn=1e9,$n=-vn;function _e(n,t,r,e){function i(v,c){return n<=v&&v<=r&&t<=c&&c<=e}function o(v,c,f,h){var s=0,a=0;if(v==null||(s=u(v,f))!==(a=u(c,f))||d(v,c)<0^f>0)do h.point(s===0||s===3?n:r,s>1?e:t);while((s=(s+f+4)%4)!==a);else h.point(c[0],c[1])}function u(v,c){return I(v[0]-n)<L?c>0?0:3:I(v[0]-r)<L?c>0?2:1:I(v[1]-t)<L?c>0?1:0:c>0?3:2}function l(v,c){return d(v.x,c.x)}function d(v,c){var f=u(v,1),h=u(c,1);return f!==h?f-h:f===0?c[1]-v[1]:f===1?v[0]-c[0]:f===2?v[1]-c[1]:c[0]-v[0]}return function(v){var c=v,f=Ht(),h,s,a,m,E,y,S,p,w,M,R,$={point:N,lineStart:T,lineEnd:Y,polygonStart:X,polygonEnd:P};function N(g,x){i(g,x)&&c.point(g,x)}function D(){for(var g=0,x=0,G=s.length;x<G;++x)for(var k=s[x],H=1,gn=k.length,U=k[0],tn,V,Pn=U[0],cn=U[1];H<gn;++H)tn=Pn,V=cn,U=k[H],Pn=U[0],cn=U[1],V<=e?cn>e&&(Pn-tn)*(e-V)>(cn-V)*(n-tn)&&++g:cn<=e&&(Pn-tn)*(e-V)<(cn-V)*(n-tn)&&--g;return g}function X(){c=f,h=[],s=[],R=!0}function P(){var g=D(),x=R&&g,G=(h=Bt(h)).length;(x||G)&&(v.polygonStart(),x&&(v.lineStart(),o(null,null,1,v),v.lineEnd()),G&&Wt(h,l,g,o,v),v.polygonEnd()),c=v,h=s=a=null}function T(){$.point=z,s&&s.push(a=[]),M=!0,w=!1,S=p=NaN}function Y(){h&&(z(m,E),y&&w&&f.rejoin(),h.push(f.result())),$.point=N,w&&c.lineEnd()}function z(g,x){var G=i(g,x);if(s&&a.push([g,x]),M)m=g,E=x,y=G,M=!1,G&&(c.lineStart(),c.point(g,x));else if(G&&w)c.point(g,x);else{var k=[S=Math.max($n,Math.min(vn,S)),p=Math.max($n,Math.min(vn,p))],H=[g=Math.max($n,Math.min(vn,g)),x=Math.max($n,Math.min(vn,x))];Le(k,H,n,t,r,e)?(w||(c.lineStart(),c.point(k[0],k[1])),c.point(H[0],H[1]),G||c.lineEnd(),R=!1):G&&(c.lineStart(),c.point(g,x),R=!1)}S=g,p=x,w=G}return $}}var Vn,jn,Dn,zn,hn={sphere:O,point:O,lineStart:$e,lineEnd:O,polygonStart:O,polygonEnd:O};function $e(){hn.point=De,hn.lineEnd=Ne}function Ne(){hn.point=hn.lineEnd=O}function De(n,t){n*=C,t*=C,jn=n,Dn=F(t),zn=A(t),hn.point=ze}function ze(n,t){n*=C,t*=C;var r=F(t),e=A(t),i=I(n-jn),o=A(i),u=F(i),l=e*u,d=zn*r-Dn*e*o,v=Dn*r+zn*e*o;Vn.add(rn(b(l*l+d*d),v)),jn=n,Dn=r,zn=e}function Fe(n){return Vn=new nn,en(n,hn),+Vn}var bn=[null,null],Ce={type:"LineString",coordinates:bn};function nt(n,t){return bn[0]=n,bn[1]=t,Fe(Ce)}var Rt={Feature:function(n,t){return An(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,e=-1,i=r.length;++e<i;)if(An(r[e].geometry,t))return!0;return!1}},xt={Sphere:function(){return!0},Point:function(n,t){return Lt(n.coordinates,t)},MultiPoint:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)if(Lt(r[e],t))return!0;return!1},LineString:function(n,t){return _t(n.coordinates,t)},MultiLineString:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)if(_t(r[e],t))return!0;return!1},Polygon:function(n,t){return $t(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,e=-1,i=r.length;++e<i;)if($t(r[e],t))return!0;return!1},GeometryCollection:function(n,t){for(var r=n.geometries,e=-1,i=r.length;++e<i;)if(An(r[e],t))return!0;return!1}};function An(n,t){return n&&xt.hasOwnProperty(n.type)?xt[n.type](n,t):!1}function Lt(n,t){return nt(n,t)===0}function _t(n,t){for(var r,e,i,o=0,u=n.length;o<u;o++){if(e=nt(n[o],t),e===0||o>0&&(i=nt(n[o],n[o-1]),i>0&&r<=i&&e<=i&&(r+e-i)*(1-Math.pow((r-e)/i,2))<qt*i))return!0;r=e}return!1}function $t(n,t){return!!Kt(n.map(Ae),Ut(t))}function Ae(n){return n=n.map(Ut),n.pop(),n}function Ut(n){return[n[0]*C,n[1]*C]}function Ie(n,t){return(n&&Rt.hasOwnProperty(n.type)?Rt[n.type]:An)(n,t)}function Nt(n,t,r){var e=fn(n,t-L,r).concat(t);return function(i){return e.map(function(o){return[i,o]})}}function Dt(n,t,r){var e=fn(n,t-L,r).concat(t);return function(i){return e.map(function(o){return[o,i]})}}function Xe(){var n,t,r,e,i,o,u,l,d=10,v=d,c=90,f=360,h,s,a,m,E=2.5;function y(){return{type:"MultiLineString",coordinates:S()}}function S(){return fn(Rn(e/c)*c,r,c).map(a).concat(fn(Rn(l/f)*f,u,f).map(m)).concat(fn(Rn(t/d)*d,n,d).filter(function(p){return I(p%c)>L}).map(h)).concat(fn(Rn(o/v)*v,i,v).filter(function(p){return I(p%f)>L}).map(s))}return y.lines=function(){return S().map(function(p){return{type:"LineString",coordinates:p}})},y.outline=function(){return{type:"Polygon",coordinates:[a(e).concat(m(u).slice(1),a(r).reverse().slice(1),m(l).reverse().slice(1))]}},y.extent=function(p){return arguments.length?y.extentMajor(p).extentMinor(p):y.extentMinor()},y.extentMajor=function(p){return arguments.length?(e=+p[0][0],r=+p[1][0],l=+p[0][1],u=+p[1][1],e>r&&(p=e,e=r,r=p),l>u&&(p=l,l=u,u=p),y.precision(E)):[[e,l],[r,u]]},y.extentMinor=function(p){return arguments.length?(t=+p[0][0],n=+p[1][0],o=+p[0][1],i=+p[1][1],t>n&&(p=t,t=n,n=p),o>i&&(p=o,o=i,i=p),y.precision(E)):[[t,o],[n,i]]},y.step=function(p){return arguments.length?y.stepMajor(p).stepMinor(p):y.stepMinor()},y.stepMajor=function(p){return arguments.length?(c=+p[0],f=+p[1],y):[c,f]},y.stepMinor=function(p){return arguments.length?(d=+p[0],v=+p[1],y):[d,v]},y.precision=function(p){return arguments.length?(E=+p,h=Nt(o,i,90),s=Dt(t,n,E),a=Nt(l,u,90),m=Dt(e,r,E),y):E},y.extentMajor([[-180,-90+L],[180,90-L]]).extentMinor([[-180,-80-L],[180,80+L]])}function Ye(){return Xe()()}const tt=n=>n;var qn=new nn,et=new nn,Vt,jt,rt,it,j={point:O,lineStart:O,lineEnd:O,polygonStart:function(){j.lineStart=Ge,j.lineEnd=Te},polygonEnd:function(){j.lineStart=j.lineEnd=j.point=O,qn.add(I(et)),et=new nn},result:function(){var n=qn/2;return qn=new nn,n}};function Ge(){j.point=Oe}function Oe(n,t){j.point=bt,Vt=rt=n,jt=it=t}function bt(n,t){et.add(it*n-rt*t),rt=n,it=t}function Te(){bt(Vt,jt)}var pn=1/0,In=pn,mn=-pn,Xn=mn,Yn={point:ke,lineStart:O,lineEnd:O,polygonStart:O,polygonEnd:O,result:function(){var n=[[pn,In],[mn,Xn]];return mn=Xn=-(In=pn=1/0),n}};function ke(n,t){n<pn&&(pn=n),n>mn&&(mn=n),t<In&&(In=t),t>Xn&&(Xn=t)}var ot=0,ut=0,dn=0,Gn=0,On=0,an=0,ct=0,lt=0,Sn=0,ne,te,K,Q,W={point:un,lineStart:zt,lineEnd:Ft,polygonStart:function(){W.lineStart=Je,W.lineEnd=Ze},polygonEnd:function(){W.point=un,W.lineStart=zt,W.lineEnd=Ft},result:function(){var n=Sn?[ct/Sn,lt/Sn]:an?[Gn/an,On/an]:dn?[ot/dn,ut/dn]:[NaN,NaN];return ot=ut=dn=Gn=On=an=ct=lt=Sn=0,n}};function un(n,t){ot+=n,ut+=t,++dn}function zt(){W.point=Be}function Be(n,t){W.point=qe,un(K=n,Q=t)}function qe(n,t){var r=n-K,e=t-Q,i=b(r*r+e*e);Gn+=i*(K+n)/2,On+=i*(Q+t)/2,an+=i,un(K=n,Q=t)}function Ft(){W.point=un}function Je(){W.point=He}function Ze(){ee(ne,te)}function He(n,t){W.point=ee,un(ne=K=n,te=Q=t)}function ee(n,t){var r=n-K,e=t-Q,i=b(r*r+e*e);Gn+=i*(K+n)/2,On+=i*(Q+t)/2,an+=i,i=Q*n-K*t,ct+=i*(K+n),lt+=i*(Q+t),Sn+=i*3,un(K=n,Q=t)}function re(n){this._context=n}re.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,Z);break}}},result:O};var ft=new nn,Jn,ie,oe,En,yn,Mn={point:O,lineStart:function(){Mn.point=We},lineEnd:function(){Jn&&ue(ie,oe),Mn.point=O},polygonStart:function(){Jn=!0},polygonEnd:function(){Jn=null},result:function(){var n=+ft;return ft=new nn,n}};function We(n,t){Mn.point=ue,ie=En=n,oe=yn=t}function ue(n,t){En-=n,yn-=t,ft.add(b(En*En+yn*yn)),En=n,yn=t}let Ct,Tn,At,It;class Xt{constructor(t){this._append=t==null?ce:Ke(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==At||this._append!==Tn){const e=this._radius,i=this._;this._="",this._append`m0,${e}a${e},${e} 0 1,1 0,${-2*e}a${e},${e} 0 1,1 0,${2*e}z`,At=e,Tn=this._append,It=this._,this._=i}this._+=It;break}}}result(){const t=this._;return this._="",t.length?t:null}}function ce(n){let t=1;this._+=n[0];for(const r=n.length;t<r;++t)this._+=arguments[t]+n[t]}function Ke(n){const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);if(t>15)return ce;if(t!==Ct){const r=10**t;Ct=t,Tn=function(i){let o=1;this._+=i[0];for(const u=i.length;o<u;++o)this._+=Math.round(arguments[o]*r)/r+i[o]}}return Tn}function Yt(n,t){let r=3,e=4.5,i,o;function u(l){return l&&(typeof e=="function"&&o.pointRadius(+e.apply(this,arguments)),en(l,i(o))),o.result()}return u.area=function(l){return en(l,i(j)),j.result()},u.measure=function(l){return en(l,i(Mn)),Mn.result()},u.bounds=function(l){return en(l,i(Yn)),Yn.result()},u.centroid=function(l){return en(l,i(W)),W.result()},u.projection=function(l){return arguments.length?(i=l==null?(n=null,tt):(n=l).stream,u):n},u.context=function(l){return arguments.length?(o=l==null?(t=null,new Xt(r)):new re(t=l),typeof e!="function"&&o.pointRadius(e),u):t},u.pointRadius=function(l){return arguments.length?(e=typeof l=="function"?l:(o.pointRadius(+l),+l),u):e},u.digits=function(l){if(!arguments.length)return r;if(l==null)r=null;else{const d=Math.floor(l);if(!(d>=0))throw new RangeError(`invalid digits: ${l}`);r=d}return t===null&&(o=new Xt(r)),u},u.projection(n).digits(r).context(t)}function st(n){return function(t){var r=new at;for(var e in n)r[e]=n[e];return r.stream=t,r}}function at(){}at.prototype={constructor:at,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function ht(n,t,r){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),en(r,n.stream(Yn)),t(Yn.result()),e!=null&&n.clipExtent(e),n}function le(n,t,r){return ht(n,function(e){var i=t[1][0]-t[0][0],o=t[1][1]-t[0][1],u=Math.min(i/(e[1][0]-e[0][0]),o/(e[1][1]-e[0][1])),l=+t[0][0]+(i-u*(e[1][0]+e[0][0]))/2,d=+t[0][1]+(o-u*(e[1][1]+e[0][1]))/2;n.scale(150*u).translate([l,d])},r)}function Qe(n,t,r){return le(n,[[0,0],t],r)}function Ue(n,t,r){return ht(n,function(e){var i=+t,o=i/(e[1][0]-e[0][0]),u=(i-o*(e[1][0]+e[0][0]))/2,l=-o*e[0][1];n.scale(150*o).translate([u,l])},r)}function Ve(n,t,r){return ht(n,function(e){var i=+t,o=i/(e[1][1]-e[0][1]),u=-o*e[0][0],l=(i-o*(e[1][1]+e[0][1]))/2;n.scale(150*o).translate([u,l])},r)}var Gt=16,je=A(30*C);function Ot(n,t){return+t?nr(n,t):be(n)}function be(n){return st({point:function(t,r){t=n(t,r),this.stream.point(t[0],t[1])}})}function nr(n,t){function r(e,i,o,u,l,d,v,c,f,h,s,a,m,E){var y=v-e,S=c-i,p=y*y+S*S;if(p>4*t&&m--){var w=u+h,M=l+s,R=d+a,$=b(w*w+M*M+R*R),N=on(R/=$),D=I(I(R)-1)<L||I(o-f)<L?(o+f)/2:rn(M,w),X=n(D,N),P=X[0],T=X[1],Y=P-e,z=T-i,g=S*Y-y*z;(g*g/p>t||I((y*Y+S*z)/p-.5)>.3||u*h+l*s+d*a<je)&&(r(e,i,o,u,l,d,P,T,D,w/=$,M/=$,R,m,E),E.point(P,T),r(P,T,D,w,M,R,v,c,f,h,s,a,m,E))}}return function(e){var i,o,u,l,d,v,c,f,h,s,a,m,E={point:y,lineStart:S,lineEnd:w,polygonStart:function(){e.polygonStart(),E.lineStart=M},polygonEnd:function(){e.polygonEnd(),E.lineStart=S}};function y(N,D){N=n(N,D),e.point(N[0],N[1])}function S(){f=NaN,E.point=p,e.lineStart()}function p(N,D){var X=sn([N,D]),P=n(N,D);r(f,h,c,s,a,m,f=P[0],h=P[1],c=N,s=X[0],a=X[1],m=X[2],Gt,e),e.point(f,h)}function w(){E.point=y,e.lineEnd()}function M(){S(),E.point=R,E.lineEnd=$}function R(N,D){p(i=N,D),o=f,u=h,l=s,d=a,v=m,E.point=p}function $(){r(f,h,c,s,a,m,o,u,i,l,d,v,Gt,e),E.lineEnd=w,w()}return E}}var tr=st({point:function(n,t){this.stream.point(n*C,t*C)}});function er(n){return st({point:function(t,r){var e=n(t,r);return this.stream.point(e[0],e[1])}})}function rr(n,t,r,e,i){function o(u,l){return u*=e,l*=i,[t+n*u,r-n*l]}return o.invert=function(u,l){return[(u-t)/n*e,(r-l)/n*i]},o}function Tt(n,t,r,e,i,o){if(!o)return rr(n,t,r,e,i);var u=A(o),l=F(o),d=u*n,v=l*n,c=u/n,f=l/n,h=(l*r-u*t)/n,s=(l*t+u*r)/n;function a(m,E){return m*=e,E*=i,[d*m-v*E+t,r-v*m-d*E]}return a.invert=function(m,E){return[e*(c*m-f*E+h),i*(s-f*m-c*E)]},a}function fe(n){return ir(function(){return n})()}function ir(n){var t,r=150,e=480,i=250,o=0,u=0,l=0,d=0,v=0,c,f=0,h=1,s=1,a=null,m=Pt,E=null,y,S,p,w=tt,M=.5,R,$,N,D,X;function P(g){return N(g[0]*C,g[1]*C)}function T(g){return g=N.invert(g[0],g[1]),g&&[g[0]*q,g[1]*q]}P.stream=function(g){return D&&X===g?D:D=tr(er(c)(m(R(w(X=g)))))},P.preclip=function(g){return arguments.length?(m=g,a=void 0,z()):m},P.postclip=function(g){return arguments.length?(w=g,E=y=S=p=null,z()):w},P.clipAngle=function(g){return arguments.length?(m=+g?xe(a=g*C):(a=null,Pt),z()):a*q},P.clipExtent=function(g){return arguments.length?(w=g==null?(E=y=S=p=null,tt):_e(E=+g[0][0],y=+g[0][1],S=+g[1][0],p=+g[1][1]),z()):E==null?null:[[E,y],[S,p]]},P.scale=function(g){return arguments.length?(r=+g,Y()):r},P.translate=function(g){return arguments.length?(e=+g[0],i=+g[1],Y()):[e,i]},P.center=function(g){return arguments.length?(o=g[0]%360*C,u=g[1]%360*C,Y()):[o*q,u*q]},P.rotate=function(g){return arguments.length?(l=g[0]%360*C,d=g[1]%360*C,v=g.length>2?g[2]%360*C:0,Y()):[l*q,d*q,v*q]},P.angle=function(g){return arguments.length?(f=g%360*C,Y()):f*q},P.reflectX=function(g){return arguments.length?(h=g?-1:1,Y()):h<0},P.reflectY=function(g){return arguments.length?(s=g?-1:1,Y()):s<0},P.precision=function(g){return arguments.length?(R=Ot($,M=g*g),z()):b(M)},P.fitExtent=function(g,x){return le(P,g,x)},P.fitSize=function(g,x){return Qe(P,g,x)},P.fitWidth=function(g,x){return Ue(P,g,x)},P.fitHeight=function(g,x){return Ve(P,g,x)};function Y(){var g=Tt(r,0,0,h,s,f).apply(null,t(o,u)),x=Tt(r,e-g[0],i-g[1],h,s,f);return c=Zt(l,d,v),$=Qn(t,x),N=Qn(c,$),R=Ot($,M),z()}function z(){return D=X=null,P}return function(){return t=n.apply(this,arguments),P.invert=t.invert&&T,Y()}}function or(n){return function(t,r){var e=b(t*t+r*r),i=n(e),o=F(i),u=A(i);return[rn(t*o,e*u),on(e&&r*o/e)]}}function pt(n,t){return[n,ge(de((B+t)/2))]}pt.invert=function(n,t){return[n,2*Jt(pe(t))-B]};function ur(){return cr(pt).scale(961/Z)}function cr(n){var t=fe(n),r=t.center,e=t.scale,i=t.translate,o=t.clipExtent,u=null,l,d,v;t.scale=function(f){return arguments.length?(e(f),c()):e()},t.translate=function(f){return arguments.length?(i(f),c()):i()},t.center=function(f){return arguments.length?(r(f),c()):r()},t.clipExtent=function(f){return arguments.length?(f==null?u=l=d=v=null:(u=+f[0][0],l=+f[0][1],d=+f[1][0],v=+f[1][1]),c()):u==null?null:[[u,l],[d,v]]};function c(){var f=_*e(),h=t(Ee(t.rotate()).invert([0,0]));return o(u==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:n===pt?[[Math.max(h[0]-f,u),l],[Math.min(h[0]+f,d),v]]:[[u,Math.max(h[1]-f,l)],[d,Math.min(h[1]+f,v)]])}return c()}function ae(n,t){return[A(t)*F(n),F(t)]}ae.invert=or(on);function lr(){return fe(ae).scale(249.5).clipAngle(90+L)}function wn(n,t,r){this.k=n,this.x=t,this.y=r}wn.prototype={constructor:wn,scale:function(n){return n===1?this:new wn(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new wn(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};wn.prototype;function kt(n,t,r){return Math.max(t,Math.min(r,n))}function fr(n,t){const r=J.useRef(),e=J.useRef(0),i=(...o)=>{const u=performance.now();if(clearTimeout(r.current),u>e.current+t){e.current=u,n(...o);return}r.current=setTimeout(()=>{n(...o),r.current=void 0},t)};return i.cancel=()=>r.current?(clearTimeout(r.current),r.current=void 0,!0):!1,J.useEffect(()=>()=>{clearTimeout(r.current),r.current=void 0},[]),i}function Zn(n,t,r,e){return n==="Mercator"?ur().scale(150).rotate(t).translate([r/2,e/2]):lr().scale(Math.min(r/2,e/2)).rotate(t).translate([r/2,e/2])}const ar=({projectionType:n,data:t,featureSelectCallback:r})=>{const e=J.useRef(null),i=J.useRef(null),o=J.useRef({isPressed:!1,isMoved:!1,lastPosition:{x:0,y:0}}),u=J.useRef([-24.9,-60.2,0]),l=J.useRef(""),d=s=>{let a=n==="Orthographic"?90:0;return[s[0],kt(s[1],-a,a),kt(s[2],0,0)]},v=(s,a)=>{if(!i.current||!t)return;const m=i.current;if(!m.getContext("2d"))return;let y=Zn(n,u.current,m.width,m.height);const S=y.invert?y.invert([s,a]):[0,0];if(!S)return null;const p=y(S);if(!p||Math.sqrt((p[0]-s)*(p[0]-s)+(p[1]-a)*(p[1]-a))>1)return null;for(const M of t.features)if(Ie(M,S))return M;return null},c=()=>{if(!i.current)return;const a=i.current.getContext("2d");a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),h(),f())},f=()=>{if(!t||!i.current)return;const s=i.current,a=s.getContext("2d");if(!a)return;let m=Zn(n,u.current,s.width,s.height),E=Yt().projection(m).context(a);t.features.forEach(y=>{a.fillStyle=l.current===y.properties.name?"orange":"#369",a.strokeStyle="white",a.beginPath(),E(y),a.fill(),a.stroke()})},h=()=>{if(!i.current)return;const s=i.current,a=s.getContext("2d");if(!a)return;let m=Zn(n,u.current,s.width,s.height),E=Yt().projection(m).context(a),y=Ye();a.beginPath(),E(y),a.strokeStyle="gray",a.lineWidth=1,a.stroke()};return J.useEffect(()=>{if(!e.current)return;const s=new ResizeObserver(()=>{if(!e.current||!i.current)return;const{clientWidth:a,clientHeight:m}=e.current;i.current.width=a,i.current.height=m,c()});return s.observe(e.current),()=>{e.current&&s.unobserve(e.current)}},[t,n]),J.useEffect(()=>{u.current=d(u.current)},[n]),J.useEffect(()=>{if(!e.current||!i.current)return;const s=i.current,a=S=>{const p=i.current;if(!p)return{x:0,y:0};const w=p.getBoundingClientRect();return"touches"in S?S.touches.length>0?{x:S.touches[0].clientX-w.left,y:S.touches[0].clientY-w.top}:{x:o.current.lastPosition.x,y:o.current.lastPosition.y}:{x:S.clientX-w.left,y:S.clientY-w.top}},m=S=>{S.preventDefault(),console.log("handleStartDrag"),o.current.isPressed=!0;const{x:p,y:w}=a(S);o.current.lastPosition={x:p,y:w}},E=S=>{if(S.preventDefault(),!o.current.isPressed)return;o.current.isMoved=!0;const{x:p,y:w}=a(S),M=p-o.current.lastPosition.x,R=w-o.current.lastPosition.y;if(o.current.lastPosition={x:p,y:w},"touches"in S&&S.touches.length>0||S instanceof MouseEvent&&S.button===0){const $=u.current;u.current=d([$[0]+M/2,$[1]-R/2,$[2]]),c()}},y=S=>{if(S.preventDefault(),console.log("handleEndDrag"),!o.current.isMoved&&(!(S instanceof MouseEvent)||S.button===0)){const{x:p,y:w}=a(S);console.log("Left-click detected at",p,w);const M=v(p,w);l.current=M?M.properties.name:null,r(M),c()}o.current.isPressed=!1,o.current.isMoved=!1};return c(),s.addEventListener("mousedown",m),window.addEventListener("mousemove",E),s.addEventListener("mouseup",y),s.addEventListener("touchstart",m),window.addEventListener("touchmove",E),s.addEventListener("touchend",y),()=>{s.removeEventListener("mousedown",m),window.removeEventListener("mousemove",E),s.removeEventListener("mouseup",y),s.removeEventListener("touchstart",m),window.removeEventListener("touchmove",E),s.removeEventListener("touchend",y)}},[t,n]),ln.jsx("div",{ref:e,style:{width:"100%",height:"100%"},children:ln.jsx("canvas",{ref:i})})},hr=({projectionType:n,setCountryInfo:t})=>{const[r,e]=J.useState(null),i=async()=>{console.log("loadData()");try{const u=await fetch("/dev-site-misc/geo/custom_110.geo.json");if(!u.ok)throw new Error("Failed to fetch JSON file");const l=await u.json();e(l)}catch(u){console.error("Error loading JSON:",u)}},o=fr(u=>{if(!u){t(null);return}let l={name:u.properties.name,name_en:u.properties.name_en,continent:u.properties.continent,pop_est:u.properties.pop_est,pop_year:u.properties.pop_year,type:u.properties.type,postal:u.properties.postal,iso_a2_eh:u.properties.iso_a2_eh};t(l)},100);return J.useEffect(()=>{console.log("useEffect"),i()},[]),ln.jsx(ln.Fragment,{children:ln.jsx(se,{width:"100%",height:"100%",sx:{position:"relative"},children:ln.jsx(ar,{projectionType:n,data:r,featureSelectCallback:o})})})};export{hr as GeoScene};
